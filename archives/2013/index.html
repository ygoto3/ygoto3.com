<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta name="description" content="Software engineer at CyberAgent."><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>ygoto3.com</title><meta name="description" content="Software engineer at CyberAgent.">
<meta property="og:type" content="website">
<meta property="og:title" content="ygoto3.com">
<meta property="og:url" content="https://ygoto3.com/archives/2013/index.html">
<meta property="og:site_name" content="ygoto3.com">
<meta property="og:description" content="Software engineer at CyberAgent.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ygoto3.com">
<meta name="twitter:description" content="Software engineer at CyberAgent.">
<meta name="twitter:creator" content="@ygoto3_">
<meta property="fb:app_id" content="777030512429159"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.css"><link rel="stylesheet" href="/css/index.css"></head><body class="container"><div id="fb-root"></div><script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5&appId=777030512429159";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script><div class="pure-g"><header class="pure-u-1"><div class="container-introduction"><div class="introduction"><a href="/"><h1 class="site-title">ygoto3.com</h1></a><p class="introduction__text">Software engineer at CyberAgent.<a href="https://twitter.com/ygoto3_" class="introduction__twitter"><i class="fa fa-lg fa-twitter-square"></i></a></p></div></div></header><div class="pure-u-1"><div class="container-posts"><article class="post"><header><a href="/posts/2012-jquery-early-2013-backbone-late-2013-angularjs/" class="post__title"><h2>2012 jQuery→Early 2013 Backbone→Late 2013 AngularJSな自分がハマった10のこと</h2></a></header><div class="post__date">December 22, 2013</div><div class="post__entry"><p>こちらは<a href="http://www.adventar.org/calendars/62" title="Frontrend Advent Calendar 2013" target="_blank" rel="external">Frontrend Advent Calendar 2013</a> 22日目の記事です。</p>
<p>本記事は、2012年までjQueryだけで開発していたフロントエンドエンジニアの自分が、<a href="http://frontrend.github.io/" title="Frontrend" target="_blank" rel="external">Frontrend</a>な方々に影響を受けたのをきっかけに、とあるコミュニティ系WebサービスでAngularJSを導入するまでの過程で影響された記事やイベントや人を時系列で紹介すると共に導入後AngularJSの開発でハマった10のことを紹介します。</p>
<h3>2012.07：Anatomy of Backbone.jsで学ぶ</h3>
<p><a href="http://angularjs.org/" title="AngularJS" target="_blank" rel="external">AngularJS</a>と言えば、MVC的なアーキテクチャをJavaScript開発に取り入れるためのフレームワークで現在は業務でも使用させていただいています。</p>
<p>しかし、振り返ってみると、2012年はMVなんちゃらなフレームワーク等には、全く無縁の生活を送っていました。</p>
<p>そんな2012年の7月頃に、Frontrendの<a href="https://twitter.com/cssradar" title="Yuya Saito" target="_blank" rel="external">Yuya Saito</a>さんに<a href="https://www.codeschool.com/" title="Code School" target="_blank" rel="external">Code School</a>の<a href="https://www.codeschool.com/courses/anatomy-of-backbonejs" title="Anatomy of Backbone.js" target="_blank" rel="external">Anatomy of Backbone.js</a>を紹介していただいて、<a href="http://backbonejs.org/" title="Backbone.js" target="_blank" rel="external">Backbone</a>をはじめとするJS開発におけるMVC的な発想を知ります。</p>
<p>ご存知の方も多いと思いますが、<a href="https://www.codeschool.com/" title="Code School" target="_blank" rel="external">Code School</a>はステップごとに用意されている講義形式の動画で学び、そのまま出題される課題をブラウザ上のエディタでコードを書いて解答して、実践的にプログラミングを学ぶことができるサービスです。</p>
<p><a href="https://www.codeschool.com/courses/anatomy-of-backbonejs" title="Anatomy of Backbone.js" target="_blank" rel="external">Anatomy of Backbone.js</a>を受講した印象としては、とても初心者が学習しやすいチュートリアルです。JSライブラリと言えば<a href="http://jquery.com/" title="jQuery" target="_blank" rel="external">jQuery</a>しか使ったことがなかった自分はここでBackboneの基本の基本を学べたと思います。</p>
<h3>2013.02：Frontrend Vol.4でBackbone導入決意</h3>
<p>基本のチュートリアルをこなしたとは言え、実際のプロジェクト(リリース済)で使うことに敷居の高さとリスクを感じ、なかなか導入することもできないまま2013年になってしまいました。</p>
<p>しかし、2月9日に開催された<a href="http://frontrend.github.io/events/04/r" title="Frontrend Vol.4" target="_blank" rel="external">Frontrend Vol.4</a>での<a href="http://aho.mu/" title="ahomu" target="_blank" rel="external">ahomu</a>さんセッション「<a href="http://vimeo.com/album/2260782/video/59558632" title="jQuery to Backbone – アーキテクチャを意識したJavaScript入門" target="_blank" rel="external">jQuery to Backbone – アーキテクチャを意識したJavaScript入門</a>」で、まさに「自分みたいにjQueryくらいしかライブラリ触ったことない人でもBackboneとか使えるかもー」と思い始めます。セッションの内容を参考にさっそく自分がフロントエンドを担当しているWebサービスでBackboneの導入を始めました。</p>
<p>このセッションは、当時のJS開発におけるjQueryが解決しない問題とBackboneを導入することで得られるメリットが分かりやすく説明されている上に、jQueryベースで記述されたコードをBackboneの構造に徐々に移していく具体的なコーディング手順まで紹介されています。自分はまさにその手順に従って、プロジェクトにBackboneを導入できたように思います。</p>
<h3>2013.09：Backbone Is Not EnoughでEmberJSとAngularJSが気になる</h3>
<p>Backboneを使い始めて半年くらい経ち、自分が担当しているサービスでは巡るめくアップデートとプロモーション施策の実装をしていかなければいけませんでした。そしてフロントエンドエンジニアが自分だけ、という状況だったこともあり「何か劇的に開発を高速化できる方法はないかな」と日々模索していました。</p>
<p>そして、<a href="http://www.shinetech.com/" title="Shine Technologies" target="_blank" rel="external">Shine Technologies</a>のブログ記事「<a href="http://blog.shinetech.com/2013/09/06/backbone-is-not-enough/" title="Backbone Is Not Enough" target="_blank" rel="external">Backbone Is Not Enough</a>」を読み、AngularJSに興味を持ち始めます。</p>
<p>記事では、Backboneでの大規模なSPA開発において、ネストされるViewをうまく構成する難しさ、Viewをテストする難しさ、メモリ管理の難しさ、容易に遅くなってしまうレンダリングへの対策やデータバインディングの重要さなどに関して<a href="http://emberjs.com/" title="EmberJS" target="_blank" rel="external">EmberJS</a>やAngularJSと比較して書かれていますが、中でも「Backboneと比較したEmberJSとAngularJSのコード記述量がかなり少ない」という1点に惹かれて、EmberJSとAngularJSが気になり始めます。</p>
<h3>2013.10：A comparison of the two-way binding in AngularJS, EmberJS and KnockoutJSでAngularJSが一番良いような気がしてくる</h3>
<p>EmberJSとAngularJSが気になり始めましたが、これらのフレームワークはそれぞれ何が違うのかは正直よく分からないでいました。Backbone単体では自分でこつこつ設定するデータバインディングを簡単に設定できる点に関しては、EmberJSもAngularJSも同じです。</p>
<p>その疑問に関しては、2013年10月に公開された<a href="http://2013.jsconf.eu/" title="JSConf EU 2013" target="_blank" rel="external">JSConf EU 2013</a>（9月開催）のMarius Gundersen氏セッションの動画「<a href="http://www.youtube.com/watch?v=mVjpwia1YN4" title="A comparison of the two-way binding in AngularJS, EmberJS and KnockoutJS" target="_blank" rel="external">A comparison of the two-way binding in AngularJS, EmberJS and KnockoutJS</a>」で解決されます。</p>
<p>このセッションでは、AngularJS、EmberJS、<a href="http://knockoutjs.com/" title="KnockoutJS" target="_blank" rel="external">KnockoutJS</a>の双方向データバインディングにおける挙動の違いが分かりやすくまとめられています。</p>
<p>このセッションにおいてAngularJSは、Dirty Checkingという仕組みと非同期でデータをバインドをしているため、</p>
<ul>
<li>リストの単純なレンダリングに関しては速い</li>
<li>Modelが複雑で巨大になってくるとレンダリングが遅い</li>
<li>コンピューティング処理が挟まれるプロパティに関しては重くなる</li>
</ul>
<p>などの特徴が説明されています。</p>
<p>担当サービスにおいて、Modelはそこまで複雑かつ巨大にならないと思った点と単純なレンダリングの速さが気に入り、AngularJSの導入を決めました。</p>
<h3>2013.10：A Better Way to Learn AngularJSで学ぶ</h3>
<p>導入を決めたら、次はAngularJSについて学習しなければいけません。</p>
<p>「<a href="https://www.codeschool.com/courses/anatomy-of-backbonejs" title="Anatomy of Backbone.js" target="_blank" rel="external">Anatomy of Backbone.js</a>」のような効率が良い（そしてできれば無料の）ラーニングリソースを探していたら（残念ながら、<a href="https://www.codeschool.com/" title="Code School" target="_blank" rel="external">Code School</a>にAngularJSのコースはありませんでした。）、「<a href="http://www.thinkster.io/pick/GtaQ0oMGIl/" title="A Better Way to Learn AngularJS" target="_blank" rel="external">A Better Way to Learn AngularJS</a>」というラーニングリソースを見つけました。</p>
<p><a href="https://www.codeschool.com/" title="Code School" target="_blank" rel="external">Code School</a>のようにコーディングで課題を問いていくリッチな機能は無いですが、初心者にも分かりやすく説明されたAngularJSのチュートリアルを動画で見ることができます。無料で学べるのですが、これを一通りこなすだけでAngularJSの基本的な使い方に関しては網羅できるように思います。</p>
<h3>2013.10：AngularJSで開発を始めていろいろとハマる</h3>
<p>もちろん基本的な使い方しか学んでいない自分は、AngularJSでサービスの開発を始めると、いろんなところでハマりました。Backboneを利用していた時と比べ、確かにコード記述量は減りましたが、AngularJSについて調べている時間は増えました。</p>
<p>そんなわけで「<a href="http://blog.shinetech.com/2013/09/06/backbone-is-not-enough/" title="Backbone Is Not Enough" target="_blank" rel="external">Backbone Is Not Enough</a>」に載っていたAngularJSの<a href="http://shinetechblog.files.wordpress.com/2013/09/learning_curves.png" target="_blank" rel="external">ラーニングカーブ</a>をしみじみ実感しましたが、同時にノウハウが溜まった後は劇的に楽になるはず、という期待でいっぱいでした。</p>
<h4>AngularJSで開発を始めてハマった10のこと</h4>
<p>本記事のタイトルにある通り、ここからはAngularJSでの開発で最初の頃に自分がハマった点を回避策とともにリストしていきたいと思います。</p>
<h5>1. JSファイルをminifyしたら動かなくなった</h5>
<p>AngularJSでは、Controllerの書き方にパターンがいくつか存在しますが、そのパターンのうちminifyするとJSが正しく動作しなくなるものがあります。</p>
<p>AngularJSにはDI (Dependency Injection)と呼ばれる仕組みがあります。Controllerで使用するserviceを指定する際に、functionの引数に指定された変数名から自動的に必要なserviceを決定できるすごい機能を持っているために、起こってしまうのがこの問題です。</p>
<p>回避策は2点。</p>
<ul>
<li>引数にわたすserviceの名前を文字列で明示する</li>
<li>ngminを使用する</li>
</ul>
<p>1点目の回避策は、引数にわたすserviceの名前を文字列で明示することです。</p>
<p>minifyすると動かない書き方（functionの引数だけでserviceを指定）</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">'myApp'</span>, [])</div><div class="line">  .controller(<span class="string">'MyCtrl'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$scope, $http</span>) </span>&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">  &#125;);</div></pre></td></tr></table></figure></p>
<p>minifyしても動く書き方（functionの引数の前に文字列でserviceを指定）</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">'myApp'</span>, [])</div><div class="line">  .controller(<span class="string">'MyCtrl'</span>, [<span class="string">'$scope'</span>, <span class="string">'$http'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$scope, $http</span>) </span>&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">  &#125;]);</div></pre></td></tr></table></figure></p>
<p>2点目の回避策は、使用するpre-minifierを<a href="https://github.com/btford/ngmin" title="ngmin" target="_blank" rel="external">ngmin</a>にすることです。</p>
<p>こちらだと動かない方の書き方をしても、ngminが動く方の書き方に変えてminifyしてくれます。これでキーの打数は減り、楽して開発できるでしょう。</p>
<h5>2. RequireJSなどで遅延ロードするとAngularJSが正しく動かない</h5>
<p>Backboneを使っているときは、モジュールごとに処理を分けてRequireJSで遅延ロードさせたりしていましたが、AngularJSで同様のことをしようと思うとモジュールのロードが完了する前にAngularの起動が行われて、意図した挙動をしなくなることがあります。</p>
<p>回避策は、手動で起動することです。</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>([<span class="string">'require'</span>, <span class="string">'exports'</span>, <span class="string">'app'</span>], <span class="function"><span class="keyword">function</span> (<span class="params">require, angular</span>) </span>&#123;</div><div class="line">  <span class="comment">// 起動前のいろんな処理...</span></div><div class="line"></div><div class="line">  <span class="comment">// 手動で起動</span></div><div class="line">  angular.bootstrap(<span class="built_in">document</span>, [<span class="string">'myApp'</span>]);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h5>3. AngularJS起動前だとng-hideなどで隠れるはずの要素が一瞬表示されてしまう</h5>
<p>SPAで作っている場合には問題ないかもしれませんが、そうでない場合、先述した手動での初期化などを行うとAngularJSの起動が遅くなり、ページロード時にngHideディレクティブなどを指定しているDOMが一瞬表示されてしまうことがあります。</p>
<p><a href="https://github.com/angular/angular.js/blob/master/css/angular.css" title="angular.css" target="_blank" rel="external">angular.css</a>を読み込んでおき、対象の要素のclass属性に<strong>ng-hide</strong>を足しておくことで回避できます。</p>
<p>ngHideなどの処理は、内容的には**display:none;**を適用するために、<strong>ng-hide</strong>というクラスを要素に付けているだけです。</p>
<p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.ng-hide</span> &#123;</div><div class="line">  <span class="attribute">display</span>: none <span class="meta">!important</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><a href="https://github.com/angular/angular.js/blob/master/css/angular.css" title="angular.css" target="_blank" rel="external">angular.css</a>を読み込まなくても、上記のようなcssが入っていれば大丈夫です。</p>
<h5>4. AngularJS起動前にが一瞬表示されてしまう</h5>
<p>上記と同様に、AngularJS起動前の評価されていないexpressionも生のテキストとしてページロード時に一瞬表示されてしまいます。</p>
<p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;comment&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>このような場合は、</p>
<p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">ng-bind</span>=<span class="string">"comment"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>で回避することができます。
もしくは、</p>
<p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">ng-cloak</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>でも可能ですが、ngCloakを使用する場合はngHide同様<a href="https://github.com/angular/angular.js/blob/master/css/angular.css" title="angular.css" target="_blank" rel="external">angular.css</a>を読み込んでおく必要があります。</p>
<p>この問題を回避するという用途的には、ngCloakを使う方が正しいようです。</p>
<h5>5. textarea要素にデフォルト値が設定できない</h5>
<p>textarea要素にデフォルト値を設定したいと思い、</p>
<p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">ng-model</span>=<span class="string">"comment"</span>&gt;</span>コメント<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>上のように設定してもテキストエリア内にもcomment Modelにも反映されません。</p>
<p>回避策は、ng-initで明示的にcomment Modelをそのデフォルト値で初期化することです。</p>
<p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">ng-init</span>=<span class="string">"comment = ‘コメント’"</span> <span class="attr">ng-model</span>=<span class="string">"comment"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h5>6. 表示テキストが2重エスケープされる</h5>
<p>AngularJSでHTMLにバインドすると自動的にエスケープがかかってしまいます。サーバサイドでエスケープ処理を施している場合は、場合によっては2重エスケープ状態が発生してしまいます。</p>
<p>そんなときは、ngSanitizeをインストールして、</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">'myApp'</span>, [<span class="string">'ngSanitize'</span>]);</div></pre></td></tr></table></figure></p>
<p>DOMには</p>
<p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;item.content&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>と書く代わりに</p>
<p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind-html</span>=<span class="string">"item.content"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>のようにしてエスケープ処理をしないようにできます。</p>
<h5>7. Directiveの命名規則がややこしい</h5>
<p>ここからは、AngularJSで一番素敵な機能だと思っているDirectiveについてのネタが続きます。</p>
<p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">x-switch</span>&gt;</span><span class="tag">&lt;/<span class="name">x-switch</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>このようなElement DirectiveをJS側で定義したいとき、</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">'myApp'</span>, [])</div><div class="line">  .directive(<span class="string">'xSwitch'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">  &#125;);</div></pre></td></tr></table></figure></p>
<p>のように、ハイフンつなぎ（x-switch）→キャメルケース（xSwitch）とする必要があります。</p>
<h5>8. カスタムDirectiveの内側のコンテンツが消える</h5>
<p>当然と言えば当然なのですが、テンプレートを指定したDirective DOMの内側にあらかじめコンテンツを入れておいてもテンプレートに置き変えられてしまいます。最初はこれに気づきませんでした。</p>
<p>Directiveの内側に入れたコンテンツをテンプレート内の特定の場所で利用したい場合は、JS側のDirective定義でtranscludeをtrueに設定し、template側のコンテンツを利用したい要素にng-transclude属性を設定する。</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">'myApp'</span>, [])</div><div class="line">  .directive(<span class="string">'someDirective'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      transclude: <span class="literal">true</span>,</div><div class="line">      template: <span class="string">'&lt;div class="well"&gt;&lt;p ng-transclude&gt;&lt;/p&gt;&lt;/div&gt;'</span>,</div><div class="line">      link: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="comment">// …</span></div><div class="line">      &#125;</div><div class="line">    &#125;;</div><div class="line">  &#125;)</div></pre></td></tr></table></figure></p>
<h5>9. カスタムDirectiveをたくさん作っていたらtemplate用HTMLファイルのリクエストでいっぱいになる</h5>
<p>カスタムDirectiveはとても便利で、HTMLを綺麗にしておけるし、処理も独立させられるのでついついたくさん作ってしまいます。そのときに使用するテンプレートHTMLを外部においてtemplateUrlで読み込ませると、そのテンプレートの数分だけリクエストが別途走ってしまいます。</p>
<p>回避策は、外部テンプレートHTMLをtemplateCacheを使用してJSにキャッシュしてくれる<a href="https://github.com/ericclemmons/grunt-angular-templates" title="grunt-angular-templates" target="_blank" rel="external">grunt-angular-templates</a>を使用することです。</p>
<p>こちらに関しては、<a href="http://www.ygoto3.com/?p=8" title="grunt-angular-templatesを使ってみた" target="_blank" rel="external">別記事</a>参照。</p>
<h5>10. AngularJS Batarangの存在を知るのが遅かった</h5>
<p>これは、ハマったことでも何でもないですが、AngularJSのデバッグをする際にDev ToolsとDOM自体にプロパティ表示用のコードを書いたりしていました。</p>
<p>AngularJSのデバッグ用Chrome Extensionに「<a href="https://github.com/angular/angularjs-batarang" title="Angular Batarang" target="_blank" rel="external">Angular Batarang</a>」というものがあります。これの存在をもっと早く知っていたらデバッグがもっと楽だっただろうと思います。</p>
<p>BackboneにもFirebug Extensionの「<a href="https://addons.mozilla.org/en-US/firefox/addon/Backbone-Eye/" title="Backbone-Eye" target="_blank" rel="external">Backbone-Eye</a>」などがありますし、やはり専用のデバッグツールがあると開発も快適です。</p>
<h3>2013.10：ブログを始める（余談）</h3>
<p>開発にハマっては調べハマっては調べしている日々の中、Frontrendの<a href="http://inkdesign.jp/" title="Hiroki Tani" target="_blank" rel="external">Hiroki Tani</a>さんに何気なく「ブログとか書いてみたらどうですか」と言われたのをきっかけに、どうせならAngularJSで調べたことでも書いてみようと思い、このブログを始めました。あまり継続して書けていないので、来年はもっと頑張ろうと思います。</p>
<h3>終わりに</h3>
<p><a href="http://www.adventar.org/calendars/62" title="Frontrend Advent Calendar 2013" target="_blank" rel="external">Frontrend Advent Calendar 2013</a>という場を借りて、とても個人的な振り返りをさせていただきました。今日この記事を書けるのも、先に書いた通り<a href="http://frontrend.github.io/" title="Frontrend" target="_blank" rel="external">Frontrend</a>の方々にいただいたきっかけが大きく影響しています。</p>
<p>明日は、<a href="http://blog.wnotes.net/blog/article/webrtc-beginning" title="ysugimoto" target="_blank" rel="external">ysugimoto</a> さんです。</p>
</div><div class="post__share"><a href="https://twitter.com/share" data-text="2012 jQuery→Early 2013 Backbone→Late 2013 AngularJSな自分がハマった10のこと" data-url="https://ygoto3.com/posts/2012-jquery-early-2013-backbone-late-2013-angularjs/" data-via="ygoto3_" class="twitter-share-button">Tweet</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
</script><div data-href="https://ygoto3.com/posts/2012-jquery-early-2013-backbone-late-2013-angularjs/" data-layout="button" class="fb-share-button"></div></div></article><article class="post"><header><a href="/posts/angularjs-12-has-no-routeprovider/" class="post__title"><h2>$routeProviderがない - AngularJS 1.2.0-rc にアップデートする際の注意</h2></a></header><div class="post__date">November 1, 2013</div><div class="post__entry"><p>2013年11月1日現在、AngularJS最新のstable versionは「1.0.8」、「1.2.0」はRC扱いになっています。</p>
<p>通常はstableな「1.0.8」を使用すればいいのですが、たとえばngAnimateなどの機能は「1.2.0」から提供されているので、ngAnimateを使いたくてアップデートすることもあるかと思います。</p>
<h3>1.2.0ではngRouteモジュールが本体から分離されている</h3>
<p>SPAで開発する場合など$routeProviderサービスを使用してルーティング処理を行っていると思いますが、1.0.8では本体に組み込まれている$routeProviderが<strong>1.2.0ではngRouteモジュールのサービスとして分離されています</strong>。</p>
<p>なので、$routeProviderを使用しているアプリで「1.2.0-rc」にアップデートした場合、下記のようなエラーがコンソールに表示されます。</p>
<p><code>Uncaught Error: [$injector:modulerr] Failed to instantiate module angularApp due to: Error: [$injector:unpr] Unknown provider: $routeProvider</code></p>
<h3>修正</h3>
<p>対応方法は簡単で、ngRouteモジュールを提供する<strong>angular-route.js</strong>を別途インストールします。例えばBowerで</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ bower install angular-route --save</div></pre></td></tr></table></figure></p>
<p>でインストールした後、HTMLファイルでangular-routeを読み込み、</p>
<p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"bower_components/angular-route/angular-route.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>依存するモジュールとして<strong>ngRoute</strong>を追加します。</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">'myApp'</span>, [<span class="string">'ngRoute'</span>])</div><div class="line">.config([<span class="string">'$routeProvider'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$routeProvider</span>) </span>&#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;]);</div></pre></td></tr></table></figure></p>
<p>これでエラーは消えて正常な動作に戻るはずです。</p>
</div><div class="post__share"><a href="https://twitter.com/share" data-text="$routeProviderがない - AngularJS 1.2.0-rc にアップデートする際の注意" data-url="https://ygoto3.com/posts/angularjs-12-has-no-routeprovider/" data-via="ygoto3_" class="twitter-share-button">Tweet</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
</script><div data-href="https://ygoto3.com/posts/angularjs-12-has-no-routeprovider/" data-layout="button" class="fb-share-button"></div></div></article><article class="post"><header><a href="/posts/try-grunt-angular-templates/" class="post__title"><h2>grunt-angular-templatesを使ってみた</h2></a></header><div class="post__date">October 31, 2013</div><div class="post__entry"><h3>AngularJSのElement Directiveを使っていて</h3>
<p>AngularJSのElement Directiveは便利でHTMLも綺麗になるので好きなんですが、テンプレートをDirectiveの中に書くのだけ好きになれません。</p>
<p>JavaScriptファイル内に文字列として書くためエディタのカラーリングも効かず、書くにくいのが嫌でした。</p>
<p>もちろんtemplateの代わりにtemplateUrlで外部HTMLを使うこともできますが、別途AJAXしてしまうので無駄にファイルのリクエスト数が増えてしまうのも好ましくありません。</p>
<p><strong>よく使うテンプレートたちは外部HTMLで書いておいて、リクエスト数は抑えたい。</strong></p>
<p>それの1つの解決方法として、今回は<strong>grunt-angular-templates</strong>を使いました。</p>
<h3>grunt-angular-templatesとは</h3>
<p><a href="https://github.com/ericclemmons/grunt-angular-templates" target="_blank" rel="external">grunt-angular-templates</a>は、Eric Clemmons氏のGruntプラグインで、指定したHTMLファイル郡をミニファイ・結合して1つのJavaScriptファイルとして出力してくれます。</p>
<p>そのJavaScriptファイルには、指定したHTMLファイルを$templateCache.putするように記述してあるので、後はそのURLをtemplateUrlで指定すると別途AJAXすることなくキャッシュしたデータを使用してくれます。</p>
<h3>インストール</h3>
<p>インストールはnpm。</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install grunt-angular-templates --save-dev</div></pre></td></tr></table></figure></p>
<p>そしてGruntfile.jsでロードを有効化。</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grunt.loadTasks(<span class="string">'grunt-angular-templates'</span>);</div></pre></td></tr></table></figure></p>
<h3>設定</h3>
<p>まずは一番シンプルな形を試します。
AngularJSのテンプレートとして書いたHTMLファイル全てを
$templateCacheにキャッシュさせるJavaScriptを出力させます。</p>
<p>Gruntfile.jsで以下の最低限のオプションだけ記述します。</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ngtemplates:  &#123;</div><div class="line">  myApp: &#123; <span class="comment">// angularのモジュール名に合わせます</span></div><div class="line">    src: <span class="string">'templates/**/*.html'</span>,</div><div class="line">    dest: <span class="string">'js/templates.js'</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>&quot;myApp&quot;はテンプレートを使うモジュール名に合わせます。</p>
<h3>実行</h3>
<p>実行します。</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ grunt ngtemplates</div></pre></td></tr></table></figure></p>
<p>もし下記のような名前のHTMLファイルを入れていれば</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">templates</div><div class="line">└── btnLike.html</div><div class="line">└── btnFollow.html</div></pre></td></tr></table></figure></p>
<p>js/templates.jsには以下のようなコードが出力されます。</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">'myApp'</span>).run([<span class="string">'$templateCache'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$templateCache</span>) </span>&#123;</div><div class="line">  $templateCache.put(<span class="string">'templates/btnFollow.html'</span>,</div><div class="line">    <span class="string">"&lt;a href=# class=\"btn btn-large btn-follow\"&gt;Follow&lt;/a&gt;"</span> </div><div class="line">  );</div><div class="line">  $templateCache.put(<span class="string">'templates/btnLike.html'</span>,</div><div class="line">    <span class="string">"&lt;a href=# class=\"btn btn-primary\"&gt;Like&lt;/a&gt;"</span> </div><div class="line">  );</div><div class="line">&#125;]);</div></pre></td></tr></table></figure></p>
<p>あとはこのjs/templates.jsを</p>
<p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/templates.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>と読み込めば、btnLike.htmlとbtnFollow.htmlの内容は読み込まれてキャッシュされるので、
使うときは$routeProviderやDirectiveのtemplateUrlで</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">'myApp'</span>)</div><div class="line">.directive(<span class="string">'btnLike'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      restrict: <span class="string">'E'</span>,</div><div class="line">      templateUrl: <span class="string">'templates/btnLike.html'</span></div><div class="line">    &#125;;</div><div class="line">  &#125;);</div></pre></td></tr></table></figure></p>
<p>という感じで使うか、またはHTMLに直接</p>
<p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-include</span>=<span class="string">"’templates/btnLike.html’"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>とngIncludeで指定して使うことができます。</p>
<h3>その他オプションを試してみる</h3>
<p>もしテンプレートが置いてあるパスと実際にアプリ内で指定するURLが違う場合は、
cwdオプションを使って下記のようにカレントディレクトリを別途指定します。</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Gruntfile.js</span></div><div class="line">ngtemplates:  &#123;</div><div class="line">  myApp: &#123;</div><div class="line">    cwd: <span class="string">'app'</span>, <span class="comment">// 実際にtemplatesディレクトリが入っているパス</span></div><div class="line">    src: <span class="string">'templates/**/*.html'</span>, <span class="comment">// アプリで使うURL</span></div><div class="line">    dest: <span class="string">'app/js/templates.js'</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>また、テンプレート用JSに変換する際に<strong>htmlmin</strong>を利用することができるので、</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Gruntfile.js</span></div><div class="line">ngtemplates:  &#123;</div><div class="line">  myApp: &#123;</div><div class="line">    src: <span class="string">'templates/**/*.html'</span>,</div><div class="line">    dest: <span class="string">'js/templates.js'</span>、</div><div class="line">    options: &#123;</div><div class="line">      htmlmin: &#123; <span class="comment">// htmlminと同じオプションを指定できる</span></div><div class="line">        collapseBooleanAttributes:      <span class="literal">true</span>,</div><div class="line">        collapseWhitespace:             <span class="literal">true</span>,</div><div class="line">        removeAttributeQuotes:          <span class="literal">true</span>,</div><div class="line">        removeComments:                 <span class="literal">true</span>,</div><div class="line">        removeEmptyAttributes:          <span class="literal">true</span>,</div><div class="line">        removeRedundantAttributes:      <span class="literal">true</span>,</div><div class="line">        removeScriptTypeAttributes:     <span class="literal">true</span>,</div><div class="line">        removeStyleLinkTypeAttributes:  <span class="literal">true</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>オプションでhtmlminを指定して出力時のファイルサイズを最適化できました。</p>
<p>grunt-angular-templatesのおかげでテンプレートの外部HTML化が実現し、リクエスト数を抑えることもできました。</p>
<p><strong>grunt-angular-templates</strong>
<a href="https://github.com/ericclemmons/grunt-angular-templates" title="grunt-angular-templates" target="_blank" rel="external">https://github.com/ericclemmons/grunt-angular-templates</a></p>
</div><div class="post__share"><a href="https://twitter.com/share" data-text="grunt-angular-templatesを使ってみた" data-url="https://ygoto3.com/posts/try-grunt-angular-templates/" data-via="ygoto3_" class="twitter-share-button">Tweet</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
</script><div data-href="https://ygoto3.com/posts/try-grunt-angular-templates/" data-layout="button" class="fb-share-button"></div></div></article><div class="container-paginator"></div></div></div></div><footer class="pure-u-1"><div class="container-footer"><div class="footer"><div class="pure-g"><div class="pure-u"><img src="/images/ygoto3-avatar.jpg" width="80" height="80" class="footer__avatar"/></div><div class="pure-u-3-4"><a href="/"><h2 class="site-title">ygoto3.com</h2></a><p class="copyright footer__copyright">&copy; 2016&nbsp;Yusuke Goto<a href="https://twitter.com/ygoto3_" class="copyright__icon"><i class="fa fa-lg fa-twitter-square"></i></a><a href="/atom.xml" class="copyright__icon"><i class="fa fa-lg fa-rss-square"></i></a></p></div></div></div></div></footer><script src="/js/app.js"></script></body></html>