<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta name="description" content="Software engineer at CyberAgent."><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>ygoto3.com</title><meta name="description" content="Software engineer at CyberAgent.">
<meta property="og:type" content="website">
<meta property="og:title" content="ygoto3.com">
<meta property="og:url" content="https://ygoto3.com/page/7/index.html">
<meta property="og:site_name" content="ygoto3.com">
<meta property="og:description" content="Software engineer at CyberAgent.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ygoto3.com">
<meta name="twitter:description" content="Software engineer at CyberAgent.">
<meta name="twitter:creator" content="@ygoto3_">
<meta property="fb:app_id" content="777030512429159"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.css"><link rel="stylesheet" href="/css/index.css"></head><body class="container"><div id="fb-root"></div><script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5&appId=777030512429159";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script><div class="pure-g"><header class="pure-u-1"><div class="container-introduction"><div class="introduction"><a href="/"><h1 class="site-title">ygoto3.com</h1></a><p class="introduction__text">Software engineer at CyberAgent.<a href="https://twitter.com/ygoto3_" class="introduction__twitter"><i class="fa fa-lg fa-twitter-square"></i></a></p></div></div></header><div class="pure-u-1"><div class="container-posts"><article class="post"><header><a href="/posts/try-grunt-angular-templates/" class="post__title"><h2>grunt-angular-templatesを使ってみた</h2></a></header><div class="post__date">October 31, 2013</div><div class="post__entry"><h3>AngularJSのElement Directiveを使っていて</h3>
<p>AngularJSのElement Directiveは便利でHTMLも綺麗になるので好きなんですが、テンプレートをDirectiveの中に書くのだけ好きになれません。</p>
<p>JavaScriptファイル内に文字列として書くためエディタのカラーリングも効かず、書くにくいのが嫌でした。</p>
<p>もちろんtemplateの代わりにtemplateUrlで外部HTMLを使うこともできますが、別途AJAXしてしまうので無駄にファイルのリクエスト数が増えてしまうのも好ましくありません。</p>
<p><strong>よく使うテンプレートたちは外部HTMLで書いておいて、リクエスト数は抑えたい。</strong></p>
<p>それの1つの解決方法として、今回は<strong>grunt-angular-templates</strong>を使いました。</p>
<h3>grunt-angular-templatesとは</h3>
<p><a href="https://github.com/ericclemmons/grunt-angular-templates" target="_blank" rel="external">grunt-angular-templates</a>は、Eric Clemmons氏のGruntプラグインで、指定したHTMLファイル郡をミニファイ・結合して1つのJavaScriptファイルとして出力してくれます。</p>
<p>そのJavaScriptファイルには、指定したHTMLファイルを$templateCache.putするように記述してあるので、後はそのURLをtemplateUrlで指定すると別途AJAXすることなくキャッシュしたデータを使用してくれます。</p>
<h3>インストール</h3>
<p>インストールはnpm。</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install grunt-angular-templates --save-dev</div></pre></td></tr></table></figure></p>
<p>そしてGruntfile.jsでロードを有効化。</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grunt.loadTasks(<span class="string">'grunt-angular-templates'</span>);</div></pre></td></tr></table></figure></p>
<h3>設定</h3>
<p>まずは一番シンプルな形を試します。
AngularJSのテンプレートとして書いたHTMLファイル全てを
$templateCacheにキャッシュさせるJavaScriptを出力させます。</p>
<p>Gruntfile.jsで以下の最低限のオプションだけ記述します。</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ngtemplates:  &#123;</div><div class="line">  myApp: &#123; <span class="comment">// angularのモジュール名に合わせます</span></div><div class="line">    src: <span class="string">'templates/**/*.html'</span>,</div><div class="line">    dest: <span class="string">'js/templates.js'</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>&quot;myApp&quot;はテンプレートを使うモジュール名に合わせます。</p>
<h3>実行</h3>
<p>実行します。</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ grunt ngtemplates</div></pre></td></tr></table></figure></p>
<p>もし下記のような名前のHTMLファイルを入れていれば</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">templates</div><div class="line">└── btnLike.html</div><div class="line">└── btnFollow.html</div></pre></td></tr></table></figure></p>
<p>js/templates.jsには以下のようなコードが出力されます。</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">'myApp'</span>).run([<span class="string">'$templateCache'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$templateCache</span>) </span>&#123;</div><div class="line">  $templateCache.put(<span class="string">'templates/btnFollow.html'</span>,</div><div class="line">    <span class="string">"&lt;a href=# class=\"btn btn-large btn-follow\"&gt;Follow&lt;/a&gt;"</span> </div><div class="line">  );</div><div class="line">  $templateCache.put(<span class="string">'templates/btnLike.html'</span>,</div><div class="line">    <span class="string">"&lt;a href=# class=\"btn btn-primary\"&gt;Like&lt;/a&gt;"</span> </div><div class="line">  );</div><div class="line">&#125;]);</div></pre></td></tr></table></figure></p>
<p>あとはこのjs/templates.jsを</p>
<p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/templates.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>と読み込めば、btnLike.htmlとbtnFollow.htmlの内容は読み込まれてキャッシュされるので、
使うときは$routeProviderやDirectiveのtemplateUrlで</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">'myApp'</span>)</div><div class="line">.directive(<span class="string">'btnLike'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      restrict: <span class="string">'E'</span>,</div><div class="line">      templateUrl: <span class="string">'templates/btnLike.html'</span></div><div class="line">    &#125;;</div><div class="line">  &#125;);</div></pre></td></tr></table></figure></p>
<p>という感じで使うか、またはHTMLに直接</p>
<p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-include</span>=<span class="string">"’templates/btnLike.html’"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>とngIncludeで指定して使うことができます。</p>
<h3>その他オプションを試してみる</h3>
<p>もしテンプレートが置いてあるパスと実際にアプリ内で指定するURLが違う場合は、
cwdオプションを使って下記のようにカレントディレクトリを別途指定します。</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Gruntfile.js</span></div><div class="line">ngtemplates:  &#123;</div><div class="line">  myApp: &#123;</div><div class="line">    cwd: <span class="string">'app'</span>, <span class="comment">// 実際にtemplatesディレクトリが入っているパス</span></div><div class="line">    src: <span class="string">'templates/**/*.html'</span>, <span class="comment">// アプリで使うURL</span></div><div class="line">    dest: <span class="string">'app/js/templates.js'</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>また、テンプレート用JSに変換する際に<strong>htmlmin</strong>を利用することができるので、</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Gruntfile.js</span></div><div class="line">ngtemplates:  &#123;</div><div class="line">  myApp: &#123;</div><div class="line">    src: <span class="string">'templates/**/*.html'</span>,</div><div class="line">    dest: <span class="string">'js/templates.js'</span>、</div><div class="line">    options: &#123;</div><div class="line">      htmlmin: &#123; <span class="comment">// htmlminと同じオプションを指定できる</span></div><div class="line">        collapseBooleanAttributes:      <span class="literal">true</span>,</div><div class="line">        collapseWhitespace:             <span class="literal">true</span>,</div><div class="line">        removeAttributeQuotes:          <span class="literal">true</span>,</div><div class="line">        removeComments:                 <span class="literal">true</span>,</div><div class="line">        removeEmptyAttributes:          <span class="literal">true</span>,</div><div class="line">        removeRedundantAttributes:      <span class="literal">true</span>,</div><div class="line">        removeScriptTypeAttributes:     <span class="literal">true</span>,</div><div class="line">        removeStyleLinkTypeAttributes:  <span class="literal">true</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>オプションでhtmlminを指定して出力時のファイルサイズを最適化できました。</p>
<p>grunt-angular-templatesのおかげでテンプレートの外部HTML化が実現し、リクエスト数を抑えることもできました。</p>
<p><strong>grunt-angular-templates</strong>
<a href="https://github.com/ericclemmons/grunt-angular-templates" title="grunt-angular-templates" target="_blank" rel="external">https://github.com/ericclemmons/grunt-angular-templates</a></p>
</div><div class="post__share"><a href="https://twitter.com/share" data-text="grunt-angular-templatesを使ってみた" data-url="https://ygoto3.com/posts/try-grunt-angular-templates/" data-via="ygoto3_" class="twitter-share-button">Tweet</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
</script><div data-href="https://ygoto3.com/posts/try-grunt-angular-templates/" data-layout="button" class="fb-share-button"></div></div></article><div class="container-paginator"><nav class="paginator pure-g"><div class="paginator__item pure-u-1-2"><a href="/page/6/">previous</a></div><div class="paginator__item pure-u-1-2"><a href="/">next</a></div></nav></div></div></div></div><footer class="pure-u-1"><div class="container-footer"><div class="footer"><div class="pure-g"><div class="pure-u"><img src="/images/ygoto3-avatar.jpg" width="80" height="80" class="footer__avatar"/></div><div class="pure-u-3-4"><a href="/"><h2 class="site-title">ygoto3.com</h2></a><p class="copyright footer__copyright">&copy; 2016&nbsp;Yusuke Goto<a href="https://twitter.com/ygoto3_" class="copyright__icon"><i class="fa fa-lg fa-twitter-square"></i></a><a href="/atom.xml" class="copyright__icon"><i class="fa fa-lg fa-rss-square"></i></a></p></div></div></div></div></footer><script src="/js/app.js"></script></body></html>